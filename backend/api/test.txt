"""
python manage.py makemigrations
python manage.py migrate
"""


# #create template

# @api_view(['POST'])
# def create_report_template(request):
#     try:
#         data = request.data
#         parent_report_id = data.get('parent_report_id')
#         template_name = data.get('template_name')
#         selected_columns = data.get('columns', [])  # List of strings

#         if not (parent_report_id and template_name and selected_columns):
#             return Response({"error": "Missing required fields"}, status=status.HTTP_400_BAD_REQUEST)

#         report = Report.objects.get(id=parent_report_id)

#         if report.template_count >= 5:
#             return Response({"error": "Max subreports reached"}, status=status.HTTP_403_FORBIDDEN)

#         with transaction.atomic():
#             template = ReportTemplate.objects.create(
#                 name=template_name,
#                 parent_report_id=parent_report_id
#             )
#             TemplateColumn.objects.bulk_create([
#                 TemplateColumn(template_id=template.id, column_name=col) for col in selected_columns
#             ])
#             report.template_count += 1
#             report.save()

#         return Response({"message": "Template created successfully"}, status=status.HTTP_201_CREATED)

#     except Report.DoesNotExist:
#         return Response({"error": "Parent report not found"}, status=status.HTTP_404_NOT_FOUND)
#     except Exception as e:
#         return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

# # list template
# @api_view(['GET'])
# def list_report_templates(request):
#     try:
#         templates = ReportTemplate.objects.select_related('parent_report').all()
#         result = []

#         for template in templates:
#             columns = TemplateColumn.objects.filter(template_id=template.id).values_list('column_name', flat=True)
#             result.append({
#                 "template_id": template.id,
#                 "template_name": template.name,
#                 "parent_report": {
#                     "id": template.parent_report.id,
#                     "name": template.parent_report.name
#                 },
#                 "columns": list(columns)
#             })

#         return Response(result, status=status.HTTP_200_OK)
#     except Exception as e:
#         return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

# # delete template
# @api_view(['DELETE'])
# def delete_template(request, template_id):
#     try:
#         template = ReportTemplate.objects.get(id=template_id)
#         report = template.parent_report

#         with transaction.atomic():
#             TemplateColumn.objects.filter(template_id=template.id).delete()
#             template.delete()

#             # Decrease template_count in parent report
#             if report.template_count > 0:
#                 report.template_count -= 1
#                 report.save()

#         return Response({"message": "Template deleted"}, status=status.HTTP_200_OK)
#     except ReportTemplate.DoesNotExist:
#         return Response({"error": "Template not found"}, status=status.HTTP_404_NOT_FOUND)
#     except Exception as e:
#         return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

# # edit template
# @api_view(['PUT'])
# def update_template(request, template_id):
#     try:
#         data = request.data
#         new_columns = data.get('columns', [])  # New list of column names

#         if not new_columns:
#             return Response({"error": "No columns provided"}, status=status.HTTP_400_BAD_REQUEST)

#         if not ReportTemplate.objects.filter(id=template_id).exists():
#             return Response({"error": "Template not found"}, status=status.HTTP_404_NOT_FOUND)

#         with transaction.atomic():
#             TemplateColumn.objects.filter(template_id=template_id).delete()
#             TemplateColumn.objects.bulk_create([
#                 TemplateColumn(template_id=template_id, column_name=col) for col in new_columns
#             ])

#         return Response({"message": "Template updated"}, status=status.HTTP_200_OK)

#     except Exception as e:
#         return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


sql queries

table name : api_reports
insert into report_builder.api_reports values (1,'Task Report',0);
insert into report_builder.api_reports values (2,'Lead Report',0);
insert into report_builder.api_reports values (3,'Enquiry Report',0);
insert into report_builder.api_reports values (4,'Quotation Report',0);
insert into report_builder.api_reports values (5,'Sample Report',0);


table name : api_reportcolumns
insert into report_builder.api_reportcolumns values (1,1,'Task Name');
insert into report_builder.api_reportcolumns values (2,1,'Task Id');
insert into report_builder.api_reportcolumns values (3,1,'Assigned To');
insert into report_builder.api_reportcolumns values (4,1,'Assigned By');
insert into report_builder.api_reportcolumns values (5,1,'Due Date');
insert into report_builder.api_reportcolumns values (6,1,'Start Date');
insert into report_builder.api_reportcolumns values (7,1,'Reporting Person');
insert into report_builder.api_reportcolumns values (8,1,'Task Description');
insert into report_builder.api_reportcolumns values (9,2,'Lead Name');
insert into report_builder.api_reportcolumns values (10,2,'Lead Generator');
insert into report_builder.api_reportcolumns values (11,2,'Lead Number');
insert into report_builder.api_reportcolumns values (12,2,'Lead For');
insert into report_builder.api_reportcolumns values (13,2,'Lead Description');
insert into report_builder.api_reportcolumns values (14,3,'Enquiry Related To');
insert into report_builder.api_reportcolumns values (15,3,'Enquiry Date');
insert into report_builder.api_reportcolumns values (16,3,'Follow Up Person');
insert into report_builder.api_reportcolumns values (17,3,'Enquiry For');
insert into report_builder.api_reportcolumns values (18,3,'Enquiry Description');
insert into report_builder.api_reportcolumns values (19,4,'Quotation ID');
insert into report_builder.api_reportcolumns values (20,4,'Transaction Date');
insert into report_builder.api_reportcolumns values (21,4,'Sales Order No');
insert into report_builder.api_reportcolumns values (22,4,'Sales Order Date');
insert into report_builder.api_reportcolumns values (23,4,'Organization Name');
insert into report_builder.api_reportcolumns values (24,4,'Organization Description');
insert into report_builder.api_reportcolumns values (25,4,'Assigned To');
insert into report_builder.api_reportcolumns values (26,4,'Valid Until');
insert into report_builder.api_reportcolumns values (27,4,'Open Activities');
insert into report_builder.api_reportcolumns values (28,4,'Closed Activities');
insert into report_builder.api_reportcolumns values (29,5,'Sample Order ID');
insert into report_builder.api_reportcolumns values (30,5,'Transaction Date');
insert into report_builder.api_reportcolumns values (31,5,'Sales Order No');
insert into report_builder.api_reportcolumns values (32,5,'Sales Order Date');
insert into report_builder.api_reportcolumns values (33,5,'Company Name');
insert into report_builder.api_reportcolumns values (34,5,'Status');

